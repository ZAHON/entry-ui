import type { UseIdParams } from './use-id.types';
import { useId as useQwikId, useConstant } from '@qwik.dev/core';

/**
 * A custom hook that generates stable, unique identifiers with support for custom prefixes and manual overrides.
 *
 * This hook is designed to provide consistent IDs for accessibility (A11Y) and DOM manipulation
 * in a Qwik-native way. By combining Qwik's `useId` for SSR-safe uniqueness and `useConstant`
 * for client-side stability, it ensures that the identifier remains unchanged throughout
 * the component's entire lifecycle.
 *
 * The generated identifier follows a specific structure:
 * `[prefix][baseId]`
 * - prefix: A string prepended to the ID (defaults to `entry-ui-qwik-`).
 * - baseId: Either a custom string provided via `generatedId` or a unique
 * sequence generated by the Qwik's `useId` hook.
 *
 * Example Outputs:
 * - Default: `"entry-ui-qwik-rs7mG5255s"` (where `"rs7mG5255s"` is the `autoId`)
 * - Custom prefix: `"my-app-header-rs7mG5255s"`
 * - Custom base: `"entry-ui-qwik-custom-id"`
 */
export const useId = (params: UseIdParams = {}) => {
  const { prefix = 'entry-ui-qwik-', generatedId } = params;

  const autoId = useQwikId();
  const id = useConstant(() => `${prefix.trim()}${generatedId ? generatedId.trim() : autoId}`);

  return id;
};
